vtsiom_date <- vtsiom_date %>% rownames_to_column() %>% pivot_longer(-rowname) %>%
mutate(Date = as.Date(value)) %>% select(Date)
vtsiom_data <- vtsiom_data %>% rownames_to_column() %>% pivot_longer(-rowname) %>%
pivot_wider(names_from = rowname, values_from = value) %>% select(-name) %>%
rename(Approve=1, Disapprove=2) %>%
mutate(Approve = round(Approve, 1),
Disapprove = round(Disapprove, 1)) %>%
mutate(source = "VTsIOM")
vtsiom_data <- cbind(vtsiom_date, vtsiom_data)
dplyr::setdiff(vtsiom_main, vtsiom_data)
write_csv(vtsiom_data, "putin-approval-vtsiom-2006.csv", row.names = FALSE)
### VTsIOM data -------
setwd("C:/Users/bizne/OneDrive/Blog/Public opinion tracker/Data")
library(readxl)
vtsiom_date <- read_xlsx("state_institutions.xlsx", range = "гос.институты!C3:ZI3", col_names = FALSE)
vtsiom_date[[639]] <- as.POSIXct("2019/02/03") #need to fix manually
vtsiom_date[[584]] <- as.POSIXct("2017/12/29") #need to fix manually
vtsiom_date[[589]] <- as.POSIXct("2018/02/11")
vtsiom_approval <- read_xlsx("state_institutions.xlsx", range = "гос.институты!C5:ZI5", col_names = FALSE)
vtsiom_disapproval <- read_xlsx("state_institutions.xlsx", range = "гос.институты!C9:ZI9", col_names = FALSE)
vtsiom_data <- rbind(vtsiom_approval, vtsiom_disapproval)
vtsiom_date <- vtsiom_date %>% rownames_to_column() %>% pivot_longer(-rowname) %>%
mutate(Date = as.Date(value)) %>% select(Date)
vtsiom_data <- vtsiom_data %>% rownames_to_column() %>% pivot_longer(-rowname) %>%
pivot_wider(names_from = rowname, values_from = value) %>% select(-name) %>%
rename(Approve=1, Disapprove=2) %>%
mutate(source = "VTsIOM")
vtsiom_data <- cbind(vtsiom_date, vtsiom_data)
write_csv(vtsiom_data, file="putin-approval-vtsiom-2006.csv", row.names = FALSE)
View(vtsiom_data)
View(vtsiom_data)
setwd(indir)
write_csv(vtsiom_data, file="putin-approval-vtsiom-2006.csv", row.names = FALSE)
write.csv(vtsiom_data, file="putin-approval-vtsiom-2006.csv", row.names = FALSE)
### FOM Data ---------------
fom_url <- "https://fom.ru/Politika/10946#tab_02"
fom_pg  <- read_html(fomurl)
fom_tab <- html_table(fompg)
## This one is the one to keep updating
fom_latest <- fomtab[[6]]
colnames(fom_latest) <- fom_latest[1]
fom_url <- "https://fom.ru/Politika/10946"
fom_pg  <- read_html(fomurl)
fom_pg  <- read_html(fom_url)
fom_tab <- html_table(fom_pg)
fom_latest <- fomtab[[6]]
fom_latest <- fom_tab[[6]]
colnames(fom_latest) <- fom_latest[1]
View(fom_latest)
fom_latest <- fom_tab[[6]]
fomt_latest <- fom_latest %>% select(X1)
View(fom_latest)
## This one is the one to keep updating
fom_latest <- fom_tab[[6]]
fomt_latest <- fom_latest %>% select(X2)
View(fom_latest)
fom_latest <- fom_latest %>% select(X2)
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1)
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1)
View(fom_latest)
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% pivot_wider(names_from = X1, values_from = value)
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1)
View(fom_latest)
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filer(X1!="")
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filter(X1!="")
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filter(X1!="") %>%
pivot_wider(names_from = X1, values_from = value)
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filter(X1!="") %>%
pivot_wider(names_from = X1, values_from = value) %>% select(-name)
fom_latest
### FOM Data ---------------
fom_url <- "https://fom.ru/Politika/10946"
fom_pg  <- read_html(fom_url)
fom_tab <- html_table(fom_pg)
## This one is the one to keep updating
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filter(X1!="") %>%
pivot_wider(names_from = X1, values_from = value) %>% select(-name) %>%
rename(Approve = Хорошо, Disapprove = Плохо, "Затрудняюсь ответить" = hard_to_say)
### FOM Data ---------------
fom_url <- "https://fom.ru/Politika/10946"
fom_pg  <- read_html(fom_url)
fom_tab <- html_table(fom_pg)
## This one is the one to keep updating
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filter(X1!="") %>%
pivot_wider(names_from = X1, values_from = value) %>% select(-name) %>%
rename(Approve = Хорошо, Disapprove = Плохо, hard_to_say = "Затрудняюсь ответить")
fom_data <- read_csv("putin-approval-fom.csv", header = TRUE)
fom_data <- read_csv("putin-approval-fom.csv", col_names  = TRUE)
View(fom_data)
fom_data <- read_csv("putin-approval-fom.csv", col_names  = TRUE,
col_types = list(col_date(), col_number(), col_number(), col_number(), col_character()))
View(fom_data)
fom_data <- read_csv("putin-approval-fom.csv", col_names  = TRUE,
col_types = list(col_date(format = "%m/%d/%Y"), col_number(), col_number(), col_number(), col_character()))
fom_data <- read_csv("putin-approval-fom.csv", col_names  = TRUE)
fom_data <- read_csv("putin-approval-fom.csv", col_names  = TRUE,
col_types = list(col_date(format = "%m/%d/%Y"), col_number(), col_number(), col_number(), col_character()))
View(fom_data)
## Append existing levada data
levada_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/putin-approval-levada-1999.csv",
col_names = TRUE)
## Append existing levada data
levada_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/putin-approval-levada-1999.csv",
col_names = TRUE,
col_types = list(col_date(format = "%m/%d/%Y"), col_double(), col_double(), col_double()))
View(levada_main)
vtsiom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/vciom-presidential-approval-2006.csv",
col_names = TRUE)
View(vtsiom_main)
vtsiom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/vciom-presidential-approval-2006.csv",
col_names = TRUE,
col_types = list(col_date(format = "%m/%d/%Y"), col_double(), col_double()))
View(vtsiom_main)
View(fom_data)
fom_data <- fom_data %>% rename(hard_to_say = "Not Sure")
View(fom_data)
dplyr::setdiff(fom_data, fom_latest)
dplyr::setdiff(fom_data, fom_latest)
fom_url <- "https://fom.ru/Politika/10946"
fom_pg  <- read_html(fom_url)
fom_tab <- html_table(fom_pg)
View(fom_tab)
View(fom_pg)
fom_test <- fom_pg %>% html_node("class")
View(fom_test)
fom_test <- fom_pg %>% html_attr"class")
fom_test <- fom_pg %>% html_attr("class")
fom_test <- fom_pg %>% html_nodes("g") %>% html_text()
fom_test <- fom_pg %>% html_nodes("#highcharts-axis") %>% html_text()
fom_pg %>% html_nodes("#highcharts-axis")
fom_pg %>% html_nodes("highcharts-axis")
fom_pg %>% html_nodes("g.highcharts-axis")
fom_pg %>% html_nodes("g")
fom_pg %>% html_nodes("#g-5")
fom_pg %>% html_nodes("#g-5" > g:nth-child(7)) %>% html_text()
fom_pg %>% html_nodes("#g-5 > g:nth-child(7)") %>% html_text()
fom_pg %>% html_nodes("#g-5") %>% html_text()
fom_pg %>% html_nodes("#g-5")
fom_pg %>% html_nodes("#g-5") %>% html_children()
fom_pg %>% html_nodes("#highcharts-0")
fom_pg %>% html_nodes("#g-5")
fom_pg %>% html_nodes("#g-8")
fom_pg %>% html_nodes("svg")
fom_pg %>% html_nodes(".highcharts-axis")
View(fom_tab)
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filter(X1!="") %>%
pivot_wider(names_from = X1, values_from = value) %>% select(-name) %>%
rename(Approve = Хорошо, Disapprove = Плохо, hard_to_say = "Затрудняюсь ответить")
dplyr::setdiff(fom_data, fom_latest)
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filter(X1!="") %>%
pivot_wider(names_from = X1, values_from = value) %>% select(-name) %>%
rename(Approve = Хорошо, Disapprove = Плохо, hard_to_say = "Затрудняюсь ответить") %>%
mutate(Date = NA)
dplyr::setdiff(fom_data, fom_latest)
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filter(X1!="") %>%
pivot_wider(names_from = X1, values_from = value) %>% select(-name) %>%
rename(Approve = Хорошо, Disapprove = Плохо, hard_to_say = "Затрудняюсь ответить") %>%
mutate(Date = NA, source = "FOM")
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filter(X1!="") %>%
pivot_wider(names_from = X1, values_from = value) %>% select(-name) %>%
rename(Approve = Хорошо, Disapprove = Плохо, hard_to_say = "Затрудняюсь ответить") %>%
mutate(Date = NA, source = "FOM")
dplyr::setdiff(fom_data, fom_latest)
View(fomt_latest)
View(fom_latest)
fom_latest <- fom_tab[[6]]
fom_latest <- fom_latest %>% select(X1,X2) %>%
pivot_longer(-X1) %>% filter(X1!="") %>%
pivot_wider(names_from = X1, values_from = value) %>% select(-name) %>%
rename(Approve = Хорошо, Disapprove = Плохо, hard_to_say = "Затрудняюсь ответить") %>%
mutate(Date = as.Date(NA), source = "FOM",
Approve = as.double(Approve),
Disapprove = as.double(Disapprove),
hard_to_say = as.double(hard_to_say))
View(fom_latest)
dplyr::setdiff(fom_data, fom_latest)
fom_data <- union(fom_data, fom_latest)
View(fom_data)
fom_data <- union(fom_main, fom_latest)
fom_main <- read_csv("putin-approval-fom.csv", col_names  = TRUE,
col_types = list(col_date(format = "%m/%d/%Y"), col_number(), col_number(), col_number(), col_character()))
fom_main <- fom_main %>% rename(hard_to_say = "Not Sure")
dplyr::setdiff(fom_main, fom_latest)
fom_data <- dplyr::union(fom_main, fom_latest)
View(fom_data)
fom_data %>% arrange(desc(Date))
date_recent <- aggregate(fom_data$Date, max)
date_recent <- fom_data %>% slice(which.max(Date))
date_recent <- fom_data %>% slice(which.max(Date))[[,1]]
View(date_recent)
# get most recent date
date_recent <- fom_data %>% which.max(Date)
date_recent <-  which.max(fom_data$Date)
date_recent <- fom_data %>% slice(which.max(Date)) %>% select(Date)
date_recent <- fom_data %>% slice(which.max(Date)) %>% select(Date) %>% pull()
date_recent + week(1)
as.Date(date_recent) + week(1)
date_recent <- fom_data %>% slice(which.max(Date)) %>% select(Date) %>% mutate(Date = as.Date(Date))
View(date_recent)
date_recent <- fom_data %>% slice(which.max(Date)) %>% select(Date) %>% mutate(Date = as.Date(Date),
Date = Date + week(1))
# get most recent date
date_recent <- fom_data %>% slice(which.max(Date)) %>% select(Date) %>% mutate(Date = as.Date(Date),
Date = Date + weeks(1))
View(date_recent)
Date = Date + weeks(1))
as.Date(date_recent) + weeks(1)
date_recent + weeks(1)
date_recent <- fom_data %>% slice(which.max(Date)) %>% select(Date) %>% mutate(Date = as.Date(Date),
Date = Date + weeks(1)) %>% pull()
date_recent + weeks(1)
fom_data %>% mutate(Date = ifelse(is.na(Date), date_recent, Date))
View(fom_data)
fom_data %>% mutate(Date = ifelse(is.na(Date), date_recent, as.Date(Date)))
fom_data %>% mutate(Date = ifelse(is.na(Date), as.Date(date_recent), as.Date(Date)))
fom_data <- fom_data %>% mutate(Date = ifelse(is.na(Date), as.Date(date_recent), as.Date(Date)))
View(fom_data)
date_recent <- fom_data %>% slice(which.max(Date)) %>% select(Date) %>% mutate(Date = as.Date(Date),
Date = Date + weeks(1)) %>% pull()
fom_data <- dplyr::union(fom_main, fom_latest)
# get most recent date
date_recent <- fom_data %>% slice(which.max(Date)) %>% select(Date) %>% mutate(Date = as.Date(Date),
Date = Date + weeks(1)) %>% pull()
fom_data %>% mutate_if(Date, is.na(), date_recent)
fom_data %>% mutate_at("Date", is.na(), date_recent)
fom_data %>% mutate_at("Date", ~ replace(., is.na(Date), date_recent))
View(fom_data)
fom_data %>% mutate_at("Date", ~ replace(., is.na(Date), date_recent)) %>% arrange(desc(Date))
test_fom <- fom_data %>% mutate_at("Date", ~ replace(., is.na(Date), date_recent)) %>% arrange(desc(Date))
dplyr::setdiff(fom_data, test_fom)
fom_main <- read_csv("putin-approval-fom.csv", col_names  = TRUE,
col_types = list(col_date(format = "%m/%d/%Y"), col_number(), col_number(), col_number(), col_character()))
fom_main <- fom_main %>% rename(hard_to_say = "Not Sure")
## Check for differences
dplyr::setdiff(fom_main, fom_latest)
fom_data <- dplyr::union(fom_main, fom_latest)
date_recent <- fom_data %>% slice(which.max(Date)) %>% select(Date) %>% mutate(Date = as.Date(Date),
Date = Date + weeks(1)) %>% pull()
test_fom <- fom_data %>% mutate_at("Date", ~ replace(., is.na(Date), date_recent)) %>% arrange(desc(Date))
dplyr::setdiff(fom_data, test_fom)
dplyr::setdiff(test_fom, fom_data)
gitdir(gitdir <- "C:\Users\bizne\OneDrive\Blog\Public opinion tracker\Published\Data")
gitdir <- "C:\Users\bizne\OneDrive\Blog\Public opinion tracker\Published\Data")
gitdir <- "C:\Users\bizne\OneDrive\Blog\Public opinion tracker\Published\Data"
gitdatadir <- "C:\Users\bizne\OneDrive\Blog\Public opinion tracker\Published\Data"
gitdatadir <- "C:/Users/bizne/OneDrive/Blog/Public opinion tracker/Published/Data"
rm(vtsiom_approval,vtsiom_date, vtsiom_main, vtsiom_latest_apprv, vtsiom_latest_dsprv, vtsiom_main,
vtsiom_url, vtsiom_pg, vtsiom_tab)
rm(lvtab, lvpg, levada_main, lvurl)
write.csv(new_fom, "putin-approval-fom.csv")
fom_data <- fom_data %>% mutate_at("Date", ~ replace(., is.na(Date), date_recent)) %>% arrange(desc(Date))
write.csv(fom_data, "putin-approval-fom.csv")
setwd(gitdatadir)
write.csv(fom_data, "putin-approval-fom.csv")
write.csv(fom_data, file="putin-approval-fom.csv", row.names = FALSE)
lvurl <- "https://www.levada.ru/indikatory/"
lvpg <- read_html(lvurl)
lvtab <- html_table(lvpg, fill=TRUE)
levada_new <- lvtab[[2]]
levada_new <- levada_new %>% rownames_to_column() %>%
pivot_longer(-rowname) %>% pivot_wider(names_from = rowname, values_from = value) %>%
select(-name) %>%
rename(Date=1, Approve=2, Disapprove=3, No.Answer=4) %>%
mutate(source = "Levada")
# reformulate dates
levada_new <- levada_new %>%
mutate(Date = as.character(Date)) %>%
mutate(Date = paste0(Date, ".15")) %>%
mutate(Date = str_replace_all(Date, "\\.2(?=\\.)", ".2000")) %>%
mutate(Date = str_replace_all(Date, "\\.201(?=\\.)", ".2010")) %>%
mutate(Date = myd(Date))
## Append existing levada data
levada_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/putin-approval-levada-1999.csv",
col_names = TRUE,
col_types = list(col_date(format = "%m/%d/%Y"), col_double(), col_double(), col_double()))
## check for differences in records
dplyr::setdiff(levada_new, levada_main)
## Append new value to existing dataset
levada_data <- dplyr::union(levada_main, levada_new)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-get_data-v2.R', encoding = 'UTF-8', echo=TRUE)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-get_data-v2.R', encoding = 'UTF-8', echo=TRUE)
## bring in existing data
fom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/putin-approval-fom.csv",
col_names  = TRUE,
col_types = list(col_date(format = "%Y/%m/%d"), col_number(), col_number(), col_number(), col_character()))
## File:        biznesslanch-putin_opinion-get_data.R
## Version:     1.0
## Description: Pulls most recent data on Putin's approval rating from Levada, FOM and VTsIOM.
## Set up -----------------
Sys.setlocale("LC_CTYPE", "russian")
library(tidyverse)
library(stringr)
library(rvest)
library(lubridate)
library(stringi)
setwd(gitdatadir)
### Update Levada Data -----------------------
lvurl <- "https://www.levada.ru/indikatory/"
lvpg <- read_html(lvurl)
lvtab <- html_table(lvpg, fill=TRUE)
levada_new <- lvtab[[2]]
levada_new <- levada_new %>% rownames_to_column() %>%
pivot_longer(-rowname) %>% pivot_wider(names_from = rowname, values_from = value) %>%
select(-name) %>%
rename(Date=1, Approve=2, Disapprove=3, No.Answer=4) %>%
mutate(source = "Levada")
# reformulate dates
levada_new <- levada_new %>%
mutate(Date = as.character(Date)) %>%
mutate(Date = paste0(Date, ".15")) %>%
mutate(Date = str_replace_all(Date, "\\.2(?=\\.)", ".2000")) %>%
mutate(Date = str_replace_all(Date, "\\.201(?=\\.)", ".2010")) %>%
mutate(Date = myd(Date))
## Append existing levada data
levada_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/putin-approval-levada-1999.csv",
col_names = TRUE,
col_types = list(col_date(format = "%Y/%m/%d"), col_double(), col_double(), col_double()))
gitdatadir <- "C:/Users/bizne/OneDrive/Blog/Public opinion tracker/Published/Data"
View(levada_main)
## Append existing levada data
levada_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/putin-approval-levada-1999.csv",
col_names = TRUE,
col_types = list(col_date(format = "%Y/%m/%d"), col_double(), col_double(), col_double(), col_character()))
## Append existing levada data
levada_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/putin-approval-levada-1999.csv",
col_names = TRUE,
col_types = list(col_date(), col_double(), col_double(), col_double(), col_character()))
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-get_data-v2.R', encoding = 'UTF-8', echo=TRUE)
rm(lvtab, lvpg, levada_main, lvurl, levada_new)
vtsiom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/vciom-presidential-approval-2006.csv",
col_names = TRUE,
col_types = list(col_date(), col_double(), col_double(), col_character()))
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-get_data-v2.R', encoding = 'UTF-8', echo=TRUE)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-get_data-v2.R', encoding = 'UTF-8', echo=TRUE)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-get_data-v2.R', encoding = 'UTF-8', echo=TRUE)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-get_data-v2.R', encoding = 'UTF-8', echo=TRUE)
vtsiom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/vciom-presidential-approval-2006.csv",
col_names = TRUE,
col_types = list(col_date(), col_double(), col_double(), col_character()))
vtsiom_main <- vtsiom_main %>% mutate(Approve = round(Approve = round(Approve, 1)),
Disapprove = round(Disapprove, 1))
View(vtsiom_main)
vtsiom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/vciom-presidential-approval-2006.csv",
col_names = TRUE,
col_types = list(col_date(), col_double(), col_double(), col_character()))
vtsiom_main <- vtsiom_main %>% mutate(Approve = round(Approve, 1),
Disapprove = round(Disapprove, 1))
View(vtsiom_main)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/Published/Scripts/biznesslanch-putin_opinion-get_data.R', encoding = 'UTF-8', echo=TRUE)
data_obtain <- "https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Scripts/biznesslanch-putin_opinion-get_data.R"
source("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Scripts/biznesslanch-putin_opinion-get_data.R")
# load Data ---------------
source("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Scripts/biznesslanch-putin_opinion-get_data.R",
encoding = "UTF-8")
# remove No answer and hard to say from Levada and FOM data
levada_data <- levada_data %>% select(-No.Answer)
fom_data    <- fom_data %>% select(-hard_to_say)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/Published/Scripts/biznesslanch-putin_opinion-tracker-v1.1.R', echo=TRUE)
install.packages("plotly")
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/Published/Scripts/biznesslanch-putin_opinion-tracker-v1.1.R', echo=TRUE)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/Published/Scripts/biznesslanch-putin_opinion-tracker-v1.1.R', echo=TRUE)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/Published/Scripts/biznesslanch-putin_opinion-tracker-v1.1.R', echo=TRUE)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-tracker-v1.R', echo=TRUE)
combined_data <- rbind(levada_data, vtsiom_data, fom_data)
combined_data$date_num <- as.numeric(combined_data$Date)*1000
# create shortcuts for plotly plot -------------------------
m <- loess(Approve ~ date_num, span=0.1, data= combined_data)
l <- loess(Disapprove ~ date_num, span=0.1, data= combined_data)
tdy_date <- Sys.Date()
tdy_date <- format(tdy_date, "%m/%d/%Y")
update <- "Last updated:"
update_cap <- paste(update, tdy_date, sep=" ")
axy <- list(title="Approval/Disapproval", hoverformat=".1f")
axx <-  list(title="", type= "date",
range=c(as.numeric(as.POSIXct("2012-03-05", format="%Y-%m-%d"))*1000,
as.numeric(as.POSIXct("2018-07-31", format="%Y-%m-%d"))*1000),
spikemode="across", spikecolor="black", spikethickness=1, spikedash="solid", spikesnap="cursor",
rangeselector = list(
buttons = list(
list(
count = 3,
label = "3 mo",
step = "month",
stepmode = "backward"),
list(
count = 6,
label = "6 mo",
step = "month",
stepmode = "backward"),
list(
count = 1,
label = "YTD",
step = "year",
stepmode = "todate"),
list(
count = 2,
label = "2 yrs",
step = "year",
stepmode = "backward"),
list(step = "all"))),
rangeslider=list(type="date", visible=TRUE, thickness=0.0))
# plot -------------------------------------------------------------
opinion_plot <- combined_data %>% na.omit() %>% plot_ly(., x= ~date_num, height = "600", width = "1100") %>%
add_markers(y= ~Approve, showlegend=FALSE, color =I("royalblue3"), alpha=0.2,
hoverinfo = "none") %>%
add_markers(y= ~Disapprove, showlegend=FALSE, color =I("red2"), alpha=0.2,
hoverinfo = "none") %>%
add_lines(y= ~fitted(loess(Approve ~ date_num, span=0.1)), showlegend=TRUE,
line= list(color="rgb(58,95,205"),
name="Approval",
hoveron="fills",
hoverinfo="text",
text= ~paste("Date:", format(Date, "%m-%d-%Y"),
"<br>Approval:", round(m$fitted,1))) %>%
add_lines(y= ~fitted(loess(Disapprove ~ date_num, span=0.1)), showlegend=FALSE,
line= list(color="red2"),
name="Disapproval",
hoverinfo="text",
text= ~paste("Date:", format(Date, "%m-%d-%Y"),
"<br>Disapproval:", round(l$fitted,1))) %>%
add_ribbons(data = augment(m),
ymin = ~.fitted - 1.96 * .se.fit,
ymax = ~.fitted + 1.96 * .se.fit,
color= I("royalblue3"), alpha=0.4, showlegend=FALSE, hoverinfo="none",
line=list(color="rgba(46,91,187,0.0)")) %>%
add_ribbons(data = augment(l),
ymin = ~.fitted - 1.96 * .se.fit,
ymax = ~.fitted + 1.96 * .se.fit,
color= I("red2"), alpha=0.4, showlegend=FALSE, hoverinfo="none",
line=list(color="rgba(220,14,14,0.0)")) %>%
add_annotations(xref="paper",yref="paper", xanchor="left",
x=0.65,y=1.075,
text="Putin Approval Rating<br><sup>From March 2012</sup><br>",
showarrow=F, align="left",
font=list(size=26,family="Arial")) %>%
add_annotations(xref="paper",yref="paper", xanchor="left",
x=0.65,y=0.97,
text=update_cap,
showarrow=F, align="left",
font=list(size=12,family="Arial")) %>%
layout(xaxis=axx, autosize=F,
yaxis=axy,
font=list(family="arial"),
hovermode="compare",
hoverlabel=list(font=list(size=16)),
spikedistance=-1,
hoverdistance=-1,
annotations = list(
list(xref = "paper", yref="paper", xanchor="middle", yanchor="middle",
x=0.325, y=1.025, showarrow=F, align="middle",
text = "Key",
font = list(size=12, family="Arial", color="#404040")),
list(xref = "paper", yref = "paper", xanchor = "left", yanchor = "middle",
x = 0.375, y = 1, showarrow = F, align = "left",
text = "<b>Lower bound</b>",
font = list(size = 10, family = "Arial", color = "#404040")),
list(xref = "paper", yref = "paper", xanchor = "left", yanchor = "middle",
x = 0.375, y = 1.04, showarrow = F, align = "left",
text = "<b>Higher bound</b>",
font = list(size = 10, family = "Arial", color = "#404040")),
list(xref = "paper", yref = "paper", xanchor = "left", yanchor = "middle",
x = 0.485, y = 1.02, showarrow = F, align = "left",
text = "<b>Estimate</b>",
font = list(size = 10, family = "Arial", color = "#404040"))),
shapes= list(
list(type = "rectangle",
xref = "paper", yref = "paper",
x0 = 0.45, x1 = 0.48, y0 = 1, y1 = 1.04,
fillcolor = "#d9d9d9",
line = list(width = 0)),
list(type = "line",
xref = "paper", yref = "paper",
x0 = 0.45, x1 = 0.48, y0 = 1, y1 = 1,
line = list(width = 2, color = "#8c8c8c")),
list(type = "line",
xref = "paper", yref = "paper",
x0 = 0.45, x1 = 0.48, y0 = 1.04, y1 = 1.04,
fillcolor = "#bfbfbf",
line = list(width = 2, color = "#8c8c8c")),
list(type = "line",
xref = "paper", yref = "paper",
x0 = 0.45, x1 = 0.48, y0 = 1.02, y1 = 1.02,
fillcolor = "#bfbfbf",
line = list(width = 2, color = "#404040")))) %>%
config(displayModeBar=F)
opinion_plot

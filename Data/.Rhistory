Sys.setlocale("LC_TIME", "Russian")
library(tidyverse)
library(stringr)
library(rvest)
library(lubridate)
httr::http_error(https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/)
httr::http_error("https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/")
### Update Levada Data -----------------------
vtsiomdat <- function(url="https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/") {
url_live <- httr::http_error("https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/")
}
vtisomdat()
vtsiomdat <- function(url="https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/") {
url_live <- httr::http_error("https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/")
return(url_live)
}
vtsiomdat()
### Update VTSiOM data ------------------
vtsiomdat <- function(url="https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/") {
url_live <- httr::http_error("https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/")
if (url_live=="TRUE"){}
else{vtsiom_url <- "https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/"
vtsiom_pg  <- read_html(vtsiom_url)
vtsiom_tab <- html_table(vtsiom_pg)
vtsiom_latest_apprv <- vtsiom_tab[[1]]
vtsiom_latest_apprv <- vtsiom_latest_apprv %>% pivot_longer(-Одобрение) %>%
pivot_wider(names_from = Одобрение, values_from = value) %>%
select(Approve="Президент России", "Date"=name)
vtsiom_latest_dsprv <- vtsiom_tab[[2]]
vtsiom_latest_dsprv <- vtsiom_latest_dsprv %>% pivot_longer(-Неодобрение) %>%
pivot_wider(names_from = Неодобрение, values_from = value) %>%
select(Disapprove="Президент России", "Date"=name)
# join approval ratings
vtsiom_latest <- right_join(vtsiom_latest_apprv, vtsiom_latest_dsprv, by="Date")
# Reformulate dates - this has to be change manually
vtsiom_latest$Date <- vtsiom_latest$Date %>% mgsub::mgsub(.,c(ru_abbrev), c(month.abb))
vtsiom_latest <- vtsiom_latest %>% mutate(Date = mdy(Date)) %>% select(Date, Approve, Disapprove) %>% mutate(source = "VTsIOM")
## Bring in existing dataset
vtsiom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/vciom-presidential-approval-2006.csv",
col_names = TRUE,
col_types = list(col_date(), col_double(), col_double(), col_character()))
## Check for duplicates
vtsiom_check <- dplyr::setdiff(vtsiom_latest, vtsiom_main)
## Append and save
vtsiom_data <- dplyr::union(vtsiom_main, vtsiom_latest)
write.csv(vtsiom_data, file="vciom-presidential-approval-2006.csv", row.names = FALSE)
}
}
vtsiomdat()
## set defaults
ru_months <- c("января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря")
ru_abbrev <- c("Янв","Февр","Март","Апр","Май","Июнь","Июль","Авг","Сент","Окт","Ноя","Дек")
### Update VTSiOM data ------------------
vtsiomdat <- function(url="https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/") {
url_live <- httr::http_error("https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/")
if (url_live=="TRUE"){}
else{vtsiom_url <- "https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/"
vtsiom_pg  <- read_html(vtsiom_url)
vtsiom_tab <- html_table(vtsiom_pg)
vtsiom_latest_apprv <- vtsiom_tab[[1]]
vtsiom_latest_apprv <- vtsiom_latest_apprv %>% pivot_longer(-Одобрение) %>%
pivot_wider(names_from = Одобрение, values_from = value) %>%
select(Approve="Президент России", "Date"=name)
vtsiom_latest_dsprv <- vtsiom_tab[[2]]
vtsiom_latest_dsprv <- vtsiom_latest_dsprv %>% pivot_longer(-Неодобрение) %>%
pivot_wider(names_from = Неодобрение, values_from = value) %>%
select(Disapprove="Президент России", "Date"=name)
# join approval ratings
vtsiom_latest <- right_join(vtsiom_latest_apprv, vtsiom_latest_dsprv, by="Date")
# Reformulate dates - this has to be change manually
vtsiom_latest$Date <- vtsiom_latest$Date %>% mgsub::mgsub(.,c(ru_abbrev), c(month.abb))
vtsiom_latest <- vtsiom_latest %>% mutate(Date = mdy(Date)) %>% select(Date, Approve, Disapprove) %>% mutate(source = "VTsIOM")
## Bring in existing dataset
vtsiom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/vciom-presidential-approval-2006.csv",
col_names = TRUE,
col_types = list(col_date(), col_double(), col_double(), col_character()))
## Check for duplicates
vtsiom_check <- dplyr::setdiff(vtsiom_latest, vtsiom_main)
## Append and save
vtsiom_data <- dplyr::union(vtsiom_main, vtsiom_latest)
write.csv(vtsiom_data, file="vciom-presidential-approval-2006.csv", row.names = FALSE)
}
}
vtsiomdat()
vtsiomdat()
### Update VTSiOM data ------------------
vtsiomdat <- function(url="https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/") {
url_live <- httr::http_error("https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/")
if (url_live=="TRUE"){}
else{vtsiom_url <- "https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/"
vtsiom_pg  <- read_html(vtsiom_url)
vtsiom_tab <- html_table(vtsiom_pg)
vtsiom_latest_apprv <- vtsiom_tab[[1]]
vtsiom_latest_apprv <- vtsiom_latest_apprv %>% pivot_longer(-Одобрение) %>%
pivot_wider(names_from = Одобрение, values_from = value) %>%
select(Approve="Президент России", "Date"=name)
vtsiom_latest_dsprv <- vtsiom_tab[[2]]
vtsiom_latest_dsprv <- vtsiom_latest_dsprv %>% pivot_longer(-Неодобрение) %>%
pivot_wider(names_from = Неодобрение, values_from = value) %>%
select(Disapprove="Президент России", "Date"=name)
# join approval ratings
vtsiom_latest <- right_join(vtsiom_latest_apprv, vtsiom_latest_dsprv, by="Date")
# Reformulate dates - this has to be change manually
vtsiom_latest$Date <- vtsiom_latest$Date %>% mgsub::mgsub(.,c(ru_abbrev), c(month.abb))
vtsiom_latest <- vtsiom_latest %>% mutate(Date = mdy(Date)) %>% select(Date, Approve, Disapprove) %>% mutate(source = "VTsIOM")
## Bring in existing dataset
vtsiom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/vciom-presidential-approval-2006.csv",
col_names = TRUE,
col_types = list(col_date(), col_double(), col_double(), col_character()))
## Check for duplicates
vtsiom_check <- dplyr::setdiff(vtsiom_latest, vtsiom_main)
## Append and save
vtsiom_data <- dplyr::union(vtsiom_main, vtsiom_latest)
#write.csv(vtsiom_data, file="vciom-presidential-approval-2006.csv", row.names = FALSE)
return(vtsiom_data)
return(vtsiom_check)
}
}
vtsiomdat()
### Update VTSiOM data ------------------
vtsiomdat <- function(url="https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/") {
url_live <- httr::http_error("https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/")
if (url_live=="TRUE"){}
else{vtsiom_url <- "https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/"
vtsiom_pg  <- read_html(vtsiom_url)
vtsiom_tab <- html_table(vtsiom_pg)
vtsiom_latest_apprv <- vtsiom_tab[[1]]
vtsiom_latest_apprv <- vtsiom_latest_apprv %>% pivot_longer(-Одобрение) %>%
pivot_wider(names_from = Одобрение, values_from = value) %>%
select(Approve="Президент России", "Date"=name)
vtsiom_latest_dsprv <- vtsiom_tab[[2]]
vtsiom_latest_dsprv <- vtsiom_latest_dsprv %>% pivot_longer(-Неодобрение) %>%
pivot_wider(names_from = Неодобрение, values_from = value) %>%
select(Disapprove="Президент России", "Date"=name)
# join approval ratings
vtsiom_latest <- right_join(vtsiom_latest_apprv, vtsiom_latest_dsprv, by="Date")
# Reformulate dates - this has to be change manually
vtsiom_latest$Date <- vtsiom_latest$Date %>% mgsub::mgsub(.,c(ru_abbrev), c(month.abb))
vtsiom_latest <- vtsiom_latest %>% mutate(Date = mdy(Date)) %>% select(Date, Approve, Disapprove) %>% mutate(source = "VTsIOM")
## Bring in existing dataset
vtsiom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/vciom-presidential-approval-2006.csv",
col_names = TRUE,
col_types = list(col_date(), col_double(), col_double(), col_character()))
## Check for duplicates
vtsiom_check <- dplyr::setdiff(vtsiom_latest, vtsiom_main)
## Append and save
vtsiom_data <- dplyr::union(vtsiom_main, vtsiom_latest)
#write.csv(vtsiom_data, file="vciom-presidential-approval-2006.csv", row.names = FALSE)
vtsiom_list <- list(vtsiom_data, vtsiom_check)
}
}
vtisom_data <- vtsiomdat()
View(vtisom_data)
unlist(vtsiom_data)
unlist(vtsiom_data)
### Update VTSiOM data ------------------
vtsiomdat <- function(url="https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/") {
url_live <- httr::http_error("https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/")
if (url_live=="TRUE"){}
else{
vtsiom_url <- url
vtsiom_pg  <- read_html(vtsiom_url)
vtsiom_tab <- html_table(vtsiom_pg)
vtsiom_latest_apprv <- vtsiom_tab[[1]]
vtsiom_latest_apprv <- vtsiom_latest_apprv %>% pivot_longer(-Одобрение) %>%
pivot_wider(names_from = Одобрение, values_from = value) %>%
select(Approve="Президент России", "Date"=name)
vtsiom_latest_dsprv <- vtsiom_tab[[2]]
vtsiom_latest_dsprv <- vtsiom_latest_dsprv %>% pivot_longer(-Неодобрение) %>%
pivot_wider(names_from = Неодобрение, values_from = value) %>%
select(Disapprove="Президент России", "Date"=name)
# join approval ratings
vtsiom_latest <- right_join(vtsiom_latest_apprv, vtsiom_latest_dsprv, by="Date")
# Reformulate dates - this has to be change manually
vtsiom_latest$Date <- vtsiom_latest$Date %>% mgsub::mgsub(.,c(ru_abbrev), c(month.abb))
vtsiom_latest <- vtsiom_latest %>% mutate(Date = mdy(Date)) %>% select(Date, Approve, Disapprove) %>% mutate(source = "VTsIOM")
## Bring in existing dataset
vtsiom_main <- read_csv("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Data/vciom-presidential-approval-2006.csv",
col_names = TRUE,
col_types = list(col_date(), col_double(), col_double(), col_character()))
## Check for duplicates
vtsiom_check <- dplyr::setdiff(vtsiom_latest, vtsiom_main)
## Append and save
vtsiom_data <- dplyr::union(vtsiom_main, vtsiom_latest)
#write.csv(vtsiom_data, file="vciom-presidential-approval-2006.csv", row.names = FALSE)
vtsiom_list <- list(vtsiom_data, vtsiom_check)
}
}
vtsiom_data <- vtsiomdat()
unlist(vtsiom_data)
vtsiom_data <- vtsiom_data[[1]]
View(vtsiom_data)
vtsiom_list <- vtsiomdat()
vtsiom_data <- vtsiom_list[[1]]
vtsiom_check <- vtsiom_list[[2]]
vtsiom_url <- "https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/"
vtsiom_pg  <- read_html(vtsiom_url)
vtsiom_tab <- html_table(vtsiom_pg)
vtsiom_latest_apprv <- vtsiom_tab[[1]]
vtsiom_latest_apprv <- vtsiom_latest_apprv %>% pivot_longer(-Одобрение) %>%
pivot_wider(names_from = Одобрение, values_from = value) %>%
select(Approve="Президент России", "Date"=name)
vtsiom_latest_dsprv <- vtsiom_tab[[2]]
vtsiom_latest_dsprv <- vtsiom_latest_dsprv %>% pivot_longer(-Неодобрение) %>%
pivot_wider(names_from = Неодобрение, values_from = value) %>%
select(Disapprove="Президент России", "Date"=name)
# join approval ratings
vtsiom_latest <- right_join(vtsiom_latest_apprv, vtsiom_latest_dsprv, by="Date")
# Reformulate dates - this has to be change manually
vtsiom_latest$Date <- vtsiom_latest$Date %>% mgsub::mgsub(.,c(ru_abbrev), c(month.abb))
View(vtsiom_latest)
vtsiom_latest <- vtsiom_latest %>% mutate(Date = mdy(Date)) %>% select(Date, Approve, Disapprove) %>% mutate(source = "VTsIOM")
View(vtsiom_latest)
vtsiom_latest <- right_join(vtsiom_latest_apprv, vtsiom_latest_dsprv, by="Date")
# Reformulate dates - this has to be change manually
vtsiom_latest$Date <- vtsiom_latest$Date %>% mgsub::mgsub(.,c(ru_abbrev), c(month.abb))
View(vtsiom_latest)
View(vtsiom_latest)
View(vtsiom_latest)
View(vtsiom_latest)
ru_abbrev <- c("Янв","Февр","Фев","Март","Апр","Май","Июнь","Июль","Авг","Сент","Окт","Ноя","Дек")
vtsiom_latest <- right_join(vtsiom_latest_apprv, vtsiom_latest_dsprv, by="Date")
# Reformulate dates - this has to be change manually
vtsiom_latest$Date <- vtsiom_latest$Date %>% mgsub::mgsub(.,c(ru_abbrev), c(month.abb))
fom_url <- "https://fom.ru/Politika/10946"
fom_pg  <- read_html(fom_url)
fom_tab <- html_table(fom_pg)
date_reg2 <- "([0-2]?[0-9]|3[01]) (января|февраля|марта|апреля|мая|июня|июля|августа|сентября|октября|ноября|декабря) [0-9]{4}"
## get date
date_text <- fom_pg %>% html_nodes(".chart-remark") %>% html_text
date_text <- date_text[5]
fom_date <- regmatches(date_text, regexpr(date_reg2, date_text))
fom_date <- mgsub::mgsub(fom_date,c(ru_months), c(month.name))
ru_abbrev <- c("Янв","Фев","Март","Апр","Май","Июнь","Июль","Авг","Сент","Окт","Ноя","Дек")
vtsiom_latest <- right_join(vtsiom_latest_apprv, vtsiom_latest_dsprv, by="Date")
# Reformulate dates - this has to be change manually
vtsiom_latest$Date <- vtsiom_latest$Date %>% mgsub::mgsub(.,c(ru_abbrev), c(month.abb))
View(vtsiom_latest)
# Reformulate dates - this has to be change manually
vtsiom_latest$Date <- vtsiom_latest$Date %>% mgsub::mgsub(.,c(ru_abbrev), c(month.abb))
vtsiom_latest <- vtsiom_latest %>% mutate(Date = mdy(Date)) %>% select(Date, Approve, Disapprove) %>% mutate(source = "VTsIOM")
View(vtsiom_latest)
vtsiom_list <- vtsiomdat()
vtsiom_data <- vtsiom_list[[1]]
vtsiom_check <- vtsiom_list[[2]]
View(vtsiom_data)
rm(vtsiom_approval,vtsiom_date, vtsiom_main, vtsiom_latest_apprv, vtsiom_latest_dsprv, vtsiom_main,
vtsiom_url, vtsiom_pg, vtsiom_tab, vtsiom_disapproval, vtsiom_latest)
rm(fom_latest, fom_main, fom_tab, fom_pg, fom_url, date_text, fom_date)
httr::http_error("https://wciom.ru/news/ratings/odobrenie_deyatelnosti_gosudarstvennyx_institutov/")
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-get_data-v3.R', encoding = 'UTF-8', echo=TRUE)
View(fom_data)
warnings()
View(levada_data)
View(levada_check)
url="https://www.levada.ru/indikatory/"
lvurl <- url
lvpg <- read_html(lvurl)
lvtab <- html_table(lvpg, fill=TRUE)
levada_new <- lvtab[[2]]
levada_new <- levada_new %>% rownames_to_column() %>%
pivot_longer(-rowname) %>% pivot_wider(names_from = rowname, values_from = value) %>%
select(-name) %>%
rename(Date=1, Approve=2, Disapprove=3, No.Answer=4) %>%
mutate(source = "Levada")
levada_new <- levada_new %>%
mutate(Date = as.character(Date)) %>%
mutate(Date = paste0(Date, ".15")) %>%
mutate(Date = str_replace_all(Date, "\\.2(?=\\.)", ".2000")) %>%
mutate(Date = str_replace_all(Date, "\\.201(?=\\.)", ".2010")) %>%
mutate(Date = str_replace_all(Date, "\\.201(?=\\.)", ".2020")) %>%
mutate(Date = myd(Date))
View(levada_new)
levada_new <- lvtab[[2]]
levada_new <- levada_new %>% rownames_to_column() %>%
pivot_longer(-rowname) %>% pivot_wider(names_from = rowname, values_from = value) %>%
select(-name) %>%
rename(Date=1, Approve=2, Disapprove=3, No.Answer=4) %>%
mutate(source = "Levada")
View(levada_data)
url="https://www.levada.ru/indikatory/"
lvurl <- url
lvpg <- read_html(lvurl)
lvtab <- html_table(lvpg, fill=TRUE)
levada_new <- lvtab[[2]]
levada_new <- levada_new %>% rownames_to_column() %>%
pivot_longer(-rowname) %>% pivot_wider(names_from = rowname, values_from = value) %>%
select(-name) %>%
rename(Date=1, Approve=2, Disapprove=3, No.Answer=4) %>%
mutate(source = "Levada")
View(levada_new)
# reformulate dates
levada_new <- levada_new %>%
mutate(Date = as.character(Date)) %>%
mutate(Date = paste0(Date, ".15")) %>%
mutate(Date = str_replace_all(Date, "\\.2(?=\\.)", ".2000")) %>%
mutate(Date = str_replace_all(Date, "\\.201(?=\\.)", ".2010")) %>%
mutate(Date = str_replace_all(Date, "\\.201(?=\\.)", ".2020")) %>%
mutate(Date = myd(Date))
View(levada_new)
levada_new <- lvtab[[2]]
levada_new <- levada_new %>% rownames_to_column() %>%
pivot_longer(-rowname) %>% pivot_wider(names_from = rowname, values_from = value) %>%
select(-name) %>%
rename(Date=1, Approve=2, Disapprove=3, No.Answer=4) %>%
mutate(source = "Levada")
# reformulate dates
levada_new <- levada_new %>%
mutate(Date = as.character(Date)) %>%
mutate(Date = paste0(Date, ".15")) %>%
mutate(Date = str_replace_all(Date, "\\.2(?=\\.)", ".2000")) %>%
mutate(Date = str_replace_all(Date, "\\.201(?=\\.)", ".2010")) %>%
mutate(Date = str_replace_all(Date, "\\.202(?=\\.)", ".2020")) %>%
mutate(Date = myd(Date))
View(levada_new)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-get_data-v3.R', encoding = 'UTF-8', echo=TRUE)
source('C:/Users/bizne/OneDrive/Blog/Public opinion tracker/biznesslanch-putin_opinion-get_data-v3.R', encoding = 'UTF-8', echo=TRUE)
View(fom_data)
View(vtsiom_check)
View(levada_data)
Sys.setenv("plotly_username"="tewonder")
Sys.setenv("plotly_api_key"="CCsRCekkcS68eBzCx3Of")
gitdatadir <- "C:/Users/bizne/OneDrive/Blog/Public opinion tracker/Published/Data"
Sys.setlocale("LC_CTYPE", "russian")
# Load packages ----------------
library(plotly)
library(broom)
library(devtools)
library(lubridate)
library(tidyverse)
# load Data ---------------
# Note: need to read in API key first (in separate script)
source_url("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Scripts/biznesslanch-putin_opinion-get_data.R",
encoding = "UTF-8")
Sys.setlocale("LC_CTYPE", "russian")
# Load packages ----------------
library(plotly)
library(broom)
library(devtools)
library(lubridate)
library(tidyverse)
# load Data ---------------
# Note: need to read in API key first (in separate script)
source_url("https://raw.githubusercontent.com/biznesslanch/Russian-Public-Opinion-Tracker/master/Scripts/biznesslanch-putin_opinion-get_data-v2.R",
encoding = "UTF-8")
# remove No answer and hard to say from Levada and FOM data
levada_data <- levada_data %>% select(-No.Answer)
fom_data    <- fom_data %>% select(-hard_to_say)
combined_data <- rbind(levada_data, vtsiom_data, fom_data)
combined_data <- combined_data %>% filter(Date >= "2012-05-07")
combined_data <- combined_data %>% mutate(Date = as.POSIXct(Date + 1, tz="GMT+3", origin="1970-01-01")) #add 1 day to Date to get correct dates
combined_data$date_num <- as.numeric(combined_data$Date)*1000
# create shortcuts for plotly plot -------------------------
m <- loess(Approve ~ date_num, span=0.1, data= combined_data)
l <- loess(Disapprove ~ date_num, span=0.1, data= combined_data)
tdy_date_dt <- Sys.Date()
tdy_date <- format(tdy_date_dt, "%m/%d/%Y")
update <- "Last updated:"
update_cap <- paste(update, tdy_date, sep=" ")
axy <- list(title="Approval/Disapproval", hoverformat=".1f")
axx <-  list(title="", type="date",
tickmode="array",
tickvalue = combined_data$Date,
spikemode="across", spikecolor="black", spikethickness=1, spikedash="solid", spikesnap="cursor",
rangeselector = list(
buttons = list(
list(
count = 3,
label = "3 mo",
step = "month",
stepmode = "backward"),
list(
count = 6,
label = "6 mo",
step = "month",
stepmode = "backward"),
list(
count = 1,
label = "YTD",
step = "year",
stepmode = "todate"),
list(
count = 2,
label = "2 yrs",
step = "year",
stepmode = "backward"),
list(step = "all"))),
rangeslider=list(type="date", visible=TRUE, thickness=0.0))
# plot -------------------------------------------------------------
opinion_plot <- combined_data %>% na.omit() %>% plot_ly(., x= ~date_num, height = "600", width = "1100") %>%
add_markers(y= ~Approve, showlegend=FALSE, color =I("royalblue3"), alpha=0.2,
hoverinfo = "none") %>%
add_markers(y= ~Disapprove, showlegend=FALSE, color =I("red2"), alpha=0.2,
hoverinfo = "none") %>%
add_lines(y= ~fitted(loess(Approve ~ date_num, span=0.1)), showlegend=TRUE,
line= list(color="rgb(58,95,205"),
name="Approval",
hoverinfo="text",
text= ~paste("Date:", format(Date, "%m-%d-%Y"),
"<br>Approval:", round(m$fitted,1))) %>%
add_lines(y= ~fitted(loess(Disapprove ~ date_num, span=0.1)), showlegend=FALSE,
line= list(color="red2"),
name="Disapproval",
hoverinfo="text",
text= ~paste("Date:", format(Date, "%m-%d-%Y"),
"<br>Disapproval:", round(l$fitted,1))) %>%
add_ribbons(data = augment(m),
ymin = ~.fitted - 1.96 * .se.fit,
ymax = ~.fitted + 1.96 * .se.fit,
color= I("royalblue3"), alpha=0.4, showlegend=FALSE, hoverinfo="none",
line=list(color="rgba(46,91,187,0.0)")) %>%
add_ribbons(data = augment(l),
ymin = ~.fitted - 1.96 * .se.fit,
ymax = ~.fitted + 1.96 * .se.fit,
color= I("red2"), alpha=0.4, showlegend=FALSE, hoverinfo="none",
line=list(color="rgba(220,14,14,0.0)")) %>%
add_annotations(xref="paper",yref="paper", xanchor="left",
x=0.65,y=1.075,
text="Putin Approval Rating<br><sup>From May 2012</sup><br>",
showarrow=F, align="left",
font=list(size=26,family="Arial")) %>%
add_annotations(xref="paper",yref="paper", xanchor="left",
x=0.65,y=0.97,
text=update_cap,
showarrow=F, align="left",
font=list(size=12,family="Arial")) %>%
layout(xaxis=axx, autosize=F,
yaxis=axy,
font=list(family="arial"),
hovermode="compare",
hoverlabel=list(font=list(size=16)),
spikedistance=-1,
hoverdistance=-1,
annotations = list(
list(xref = "paper", yref="paper", xanchor="middle", yanchor="middle",
x=0.325, y=1.025, showarrow=F, align="middle",
text = "Key",
font = list(size=12, family="Arial", color="#404040")),
list(xref = "paper", yref = "paper", xanchor = "left", yanchor = "middle",
x = 0.375, y = 1, showarrow = F, align = "left",
text = "<b>Lower bound</b>",
font = list(size = 10, family = "Arial", color = "#404040")),
list(xref = "paper", yref = "paper", xanchor = "left", yanchor = "middle",
x = 0.375, y = 1.04, showarrow = F, align = "left",
text = "<b>Higher bound</b>",
font = list(size = 10, family = "Arial", color = "#404040")),
list(xref = "paper", yref = "paper", xanchor = "left", yanchor = "middle",
x = 0.485, y = 1.02, showarrow = F, align = "left",
text = "<b>Estimate</b>",
font = list(size = 10, family = "Arial", color = "#404040"))),
shapes= list(
list(type = "rectangle",
xref = "paper", yref = "paper",
x0 = 0.45, x1 = 0.48, y0 = 1, y1 = 1.04,
fillcolor = "#d9d9d9",
line = list(width = 0)),
list(type = "line",
xref = "paper", yref = "paper",
x0 = 0.45, x1 = 0.48, y0 = 1, y1 = 1,
line = list(width = 2, color = "#8c8c8c")),
list(type = "line",
xref = "paper", yref = "paper",
x0 = 0.45, x1 = 0.48, y0 = 1.04, y1 = 1.04,
fillcolor = "#bfbfbf",
line = list(width = 2, color = "#8c8c8c")),
list(type = "line",
xref = "paper", yref = "paper",
x0 = 0.45, x1 = 0.48, y0 = 1.02, y1 = 1.02,
fillcolor = "#bfbfbf",
line = list(width = 2, color = "#404040")))) %>%
config(displayModeBar=F)
opinion_plot
# note, this last line will not run w/o the API key
api_create(opinion_plot, filename = "biznesslanch-ru_opinion-tracker-v1.1")
moe <- function(n=1000, proportion=0.5) {
moe <- 1.96*sqrt((prop*(1-prop))/n)
}
moe()
moe <- function(n=1000, prop=0.5) {
moe <- 1.96*sqrt((prop*(1-prop))/n)
}
moe()
moe <- function(n=1000, prop=0.5) {
moe <- 1.96*sqrt((prop*(1-prop))/n)
moe
}
moe()
moe <- function(n=1000, prop=0.5) {
moe <- 1.96*sqrt((prop*(1-prop))/n)
round(moe*100,2)
}
moe()
moe(n=1600, prop = .68)
moe <- function(n=1000, prop=0.5) {
moe <- 1.96*sqrt((prop*(1-prop))/n)
round(moe*100,1)
}
moe()
moe(n=1600, prop = .68)
moe(n=1600, prop = .9)
moe(n=1600)
prop <- .68
n    <- 1600
prop*(1-prop)
1-prop
.2176/1600
sqrt(.000136)
1.96*.0116619
moe(prop=.5)
moe(prop=.5, n=800)
moe(prop=.5, n=900)
moe(prop=.5, n=850)
